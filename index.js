var express = require('express');
var app = express();

app.set('port', (process.env.PORT || 5000));

app.use(express.static(__dirname + '/public'));

// views is directory for all template files
app.set('views', __dirname + '/views');
app.set('view engine', 'ejs');

app.get('/', function(request, response) {
  response.render('pages/index');
});

app.get('/pw_gen', function(request, response) {
	var pw_hour_array = [
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 8, 21, 32, 48, 55, 73, 68, 57, 78, 55, 142, 168, 162, 175, 184, 186, 193, 220, 233, 239, 246, 261, 269, 277, 285, 294, 294, 299, 306, 310, 296, 303, 127, 144, 136, 255, 305, 335, 155, 181, 331, 314, 305, 297, 287, 284, 277, 269, 264, 256, 248, 241, 225, 214, 200, 182, 173, 156, 144, 126, 110, 96, 85, 70, 53, 22, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 44, 70, 84, 133, 180, 225, 261, 314, 363, 411, 458, 503, 562, 602, 645, 675, 704, 745, 783, 817, 844, 872, 902, 923, 938, 953, 965, 991, 999, 1014, 1031, 1031, 1040, 1040, 1048, 1048, 1050, 1042, 1033, 1029, 1019, 1008, 991, 982, 965, 942, 927, 904, 874, 842, 806, 779, 726, 689, 649, 611, 568, 520, 481, 430, 386, 333, 288, 244, 199, 163, 121, 91, 67, 46, 27, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 9, 27, 40, 84, 161, 198, 234, 281, 338, 382, 428, 276, 629, 410, 413, 235, 584, 805, 865, 875, 932, 987, 709, 545, 1098, 1028, 1061, 1085, 278, 1070, 1062, 1062, 1061, 1075, 1075, 1080, 1085, 1079, 1069, 1066, 1051, 1035, 1012, 1018, 1002, 996, 965, 947, 922, 895, 875, 826, 790, 764, 712, 664, 651, 610, 540, 520, 460, 410, 369, 351, 325, 276, 240, 206, 175, 131, 87, 66, 42, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 4, 4, 1, 3, 10, 12, 12, 13, 16, 18, 19, 9, 21, 22, 22, 22, 24, 24, 24, 25, 25, 27, 27, 27, 27, 28, 27, 27, 25, 25, 28, 27, 27, 27, 25, 27, 25, 25, 24, 24, 24, 13, 21, 19, 21, 15, 19, 4, 7, 16, 13, 13, 12, 10, 7, 7, 7, 4, 4, 3, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 3, 4, 5, 7, 10, 13, 16, 19, 22, 26, 30, 32, 35, 37, 40, 42, 43, 48, 52, 53, 54, 57, 54, 22, 60, 63, 64, 16, 18, 22, 53, 46, 30, 51, 67, 40, 47, 60, 57, 64, 64, 63, 62, 59, 59, 58, 55, 54, 54, 48, 51, 48, 24, 40, 43, 35, 32, 30, 30, 24, 23, 19, 17, 16, 13, 10, 8, 5, 4, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 8, 12, 11, 23, 28, 30, 32, 36, 38, 41, 43, 44, 48, 51, 54, 55, 55, 58, 58, 60, 65, 69, 69, 24, 26, 23, 55, 66, 29, 75, 28, 30, 20, 26, 26, 72, 14, 6, 6, 6, 6, 17, 9, 13, 10, 7, 4, 0, 0, 1, 0, 2, 6, 4, 13, 9, 10, 15, 17, 10, 11, 7, 7, 5, 3, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 23, 185, 315, 533, 588, 732, 839, 1006, 1270, 1534, 1715, 1595, 1979, 1349, 2438, 2448, 2522, 2007, 2726, 2921, 2795, 3064, 3051, 1279, 3250, 2499, 3324, 2058, 3306, 3306, 3417, 3426, 3398, 3440, 3454, 3477, 3459, 3454, 3463, 3398, 3384, 3361, 3319, 3259, 3194, 3157, 3111, 3041, 2976, 2911, 2814, 2698, 2610, 2462, 2341, 2304, 2207, 2044, 1961, 1748, 1544, 1363, 1381, 1224, 1071, 922, 806, 709, 514, 343, 259, 180, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 4, 6, 7, 10, 12, 15, 16, 18, 19, 21, 7, 28, 32, 6, 32, 34, 36, 7, 10, 9, 10, 38, 24, 39, 45, 10, 7, 26, 45, 18, 44, 43, 43, 41, 41, 42, 42, 41, 40, 40, 39, 39, 39, 37, 36, 35, 34, 32, 31, 30, 29, 27, 25, 25, 22, 19, 18, 16, 16, 12, 10, 10, 9, 7, 4, 3, 3, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 3, 4, 6, 7, 8, 9, 10, 12, 13, 14, 14, 16, 16, 18, 19, 21, 21, 22, 22, 23, 24, 24, 25, 25, 25, 26, 26, 27, 27, 27, 28, 27, 27, 27, 27, 27, 27, 26, 26, 26, 26, 24, 25, 24, 23, 23, 22, 21, 20, 20, 18, 17, 16, 15, 14, 12, 12, 11, 10, 8, 6, 5, 4, 3, 2, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 11, 18, 31, 48, 68, 53, 117, 138, 159, 183, 208, 237, 252, 263, 289, 309, 315, 327, 345, 355, 368, 376, 388, 396, 407, 411, 418, 424, 405, 435, 441, 444, 446, 446, 452, 452, 441, 448, 450, 446, 444, 444, 360, 435, 428, 424, 416, 409, 399, 392, 384, 371, 358, 348, 336, 321, 305, 286, 266, 245, 228, 205, 185, 161, 138, 115, 87, 70, 52, 33, 24, 14, 9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 42, 64, 106, 103, 157, 214, 274, 296, 367, 401, 441, 523, 516, 517, 482, 657, 711, 662, 765, 812, 838, 885, 886, 914, 949, 901, 892, 877, 586, 873, 245, 182, 231, 347, 179, 571, 514, 583, 701, 285, 245, 188, 271, 258, 479, 506, 298, 198, 199, 584, 207, 632, 271, 220, 217, 207, 468, 253, 102, 59, 122, 290, 411, 398, 195, 196, 119, 99, 75, 51, 26, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 3, 5, 8, 10, 17, 21, 7, 4, 3, 4, 21, 3, 8, 13, 68, 42, 63, 73, 76, 80, 81, 82, 15, 12, 14, 21, 100, 17, 21, 83, 33, 97, 94, 88, 24, 96, 61, 85, 17, 16, 46, 63, 54, 88, 13, 78, 76, 75, 73, 14, 15, 68, 58, 54, 53, 48, 44, 43, 36, 31, 25, 22, 18, 13, 9, 7, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 5, 8, 3, 4, 6, 17, 25, 24, 27, 27, 19, 26, 7, 16, 39, 5, 38, 14, 6, 30, 27, 8, 14, 30, 47, 46, 24, 20, 50, 24, 51, 16, 11, 13, 50, 13, 12, 50, 48, 48, 44, 47, 15, 32, 9, 41, 39, 33, 22, 33, 33, 30, 28, 22, 9, 22, 15, 17, 14, 12, 10, 8, 7, 5, 4, 3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 1, 1, 2, 3, 4, 5, 6, 9, 9, 12, 13, 15, 15, 17, 17, 18, 20, 21, 21, 23, 24, 24, 25, 25, 27, 27, 27, 27, 5, 29, 26, 30, 28, 7, 7, 18, 12, 31, 30, 24, 28, 13, 18, 24, 26, 26, 26, 15, 15, 19, 6, 5, 5, 7, 10, 10, 10, 3, 4, 10, 8, 8, 2, 2, 2, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 4, 6, 7, 11, 14, 17, 20, 24, 29, 31, 34, 37, 40, 42, 43, 47, 49, 50, 51, 52, 53, 54, 57, 60, 60, 65, 17, 66, 31, 48, 62, 40, 65, 65, 65, 63, 62, 62, 62, 61, 60, 59, 57, 55, 54, 54, 51, 55, 55, 28, 50, 29, 20, 44, 34, 34, 30, 25, 23, 21, 18, 15, 12, 12, 7, 5, 5, 3, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 136, 227, 317, 441, 544, 778, 979, 1186, 1355, 1595, 1835, 2043, 2263, 2412, 2704, 2886, 3061, 3106, 3275, 3495, 3599, 3722, 3820, 4060, 4170, 4228, 4267, 4371, 4436, 4494, 4533, 4598, 4656, 4669, 4695, 4715, 4702, 4702, 4695, 4624, 4663, 4618, 4533, 4468, 4436, 4384, 4306, 4228, 4144, 4034, 3891, 3748, 3599, 3482, 3255, 3100, 2951, 2788, 2600, 2406, 2224, 2023, 1783, 1550, 1310, 1141, 940, 778, 635, 441, 343, 259, 194, 19, 19, 12, 19, 6, 6, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
	];
	var units = ["金門金沙", "台中生水池", "興達生水池", "嘉義民雄", "中部儲運", "東勢新伯公", "永安鹽灘地",
                  "路北", "中大", "大潭生水池", "核三生水池", "七美", "尖山", "卓蘭", "后里", "台中龍井"];
	
	// get taiwan time
	var d = new Date()
	var hour = d.toLocaleString('en-US', {hour: '2-digit',   hour12: false, timeZone: 'Asia/Taipei' });
	var minute = d.toLocaleString('en-US', {minute: '2-digit',  timeZone: 'Asia/Taipei' });
	
	//var hour = d.toLocaleString('en-US', {hour: '2-digit',   hour12: false, timeZone: 'europe/paris' });
	//var minute = d.toLocaleString('en-US', {minute: '2-digit',  timeZone: 'europe/paris' });
	
	var index = hour*6 + Math.floor(minute/10);
	
	// generate json string
	var jsonString = "{";
	for (i = 0; i < units.length; i++) {
		var pw_gen = 0;
		for(j = index; j >= 0 && j > index-6 && j < 144; j--) {
			pw_gen += pw_hour_array[i][j];
		}
		jsonString = jsonString + '"' + units[i] + '": "' + Math.floor(pw_gen/6) + '"';
				
		if(i < units.length-1) {
			jsonString += ",";
		}
	}
	jsonString += "}";
	
	response.json(JSON.parse(jsonString));
	/*
  response.json(
	{
		"金門金沙": "30",
		"台中生水池": "30",
		"興達生水池": "30",
		"嘉義民雄": "30",
		"中部儲運": "30",
		"東勢新伯公": "30",
		"永安鹽灘地": "30",
		"路北": "30",
		"中大": "30",
		"大潭生水池": "30",
		"核三生水池": "30",
		"七美": "30",
		"尖山": "30",
		"卓蘭": "30",
		"后里": "30",
		"台中龍井": "30"
	}
	);
	*/
});

app.get('/history', function(request, response) {
	var pwarray = [
		[1922, 1959, 2104, 2082, 2264, 2169, 2240, 2310, 2310, 2246, 1914, 2229, 1994, 2067, 1938, 2230, 1987, 2070, 1932, 2025, 2058, 2277, 2187, 2147, 1945, 2234, 2068, 2201, 2201, 2160, 2264],
		[6991, 7722, 7782, 8006, 7136, 8001, 7876, 7463, 7145, 8042, 7645, 7800, 6973, 7228, 8291, 8395, 7778, 7381, 7916, 7928, 7506, 7903, 8040, 8285, 7918, 7118, 7128, 7375, 7000, 7051, 8404],
		[8024, 7710, 7749, 7990, 7127, 8393, 7942, 7284, 8507, 7911, 7272, 7368, 8287, 7228, 7769, 7278, 7916, 7647, 7180, 7820, 7919, 8031, 8204, 7571, 7394, 7455, 8486, 7337, 8288, 7169, 8405],
		[190, 183, 182, 169, 170, 171, 170, 182, 164, 183, 168, 177, 180, 168, 192, 193, 179, 191, 194, 171, 198, 178, 174, 191, 188, 189, 183, 183, 193, 198, 192],
		[418, 460, 432, 441, 411, 415, 392, 391, 403, 436, 386, 410, 458, 465, 431, 429, 398, 447, 463, 406, 397, 445, 454, 385, 451, 427, 434, 416, 445, 413, 440],
		[269, 267, 291, 303, 309, 305, 286, 312, 313, 302, 293, 314, 293, 308, 282, 275, 275, 271, 312, 321, 264, 275, 307, 319, 293, 305, 297, 287, 308, 305, 266],
		[25729, 27408, 25091, 25178, 24720, 28005, 26621, 23588, 23589, 26893, 26032, 23890, 28516, 26067, 26757, 26162, 25649, 25597, 27532, 26913, 26931, 24657, 27368, 25610, 27982, 28611, 25539, 27759, 24523, 25605, 27856],
		[296, 248, 290, 246, 254, 277, 275, 248, 261, 259, 288, 267, 292, 259, 283, 282, 279, 267, 291, 277, 295, 254, 288, 278, 252, 285, 274, 291, 269, 285, 290],
		[211, 185, 188, 202, 215, 202, 189, 210, 183, 216, 204, 216, 187, 190, 217, 183, 196, 215, 217, 207, 189, 197, 201, 180, 196, 211, 217, 216, 199, 213, 180],
		[3760, 3532, 3149, 3255, 3602, 3263, 3841, 3643, 3552, 3404, 3650, 3272, 3739, 3622, 3164, 3262, 3769, 3675, 3617, 3574, 3575, 3275, 3257, 3333, 3499, 3546, 3399, 3354, 3674, 3766, 3216],
		[4568, 5179, 4943, 4761, 5085, 4738, 4451, 5196, 4327, 5102, 4729, 4341, 4342, 5187, 5216, 4887, 5030, 4518, 5106, 4574, 5179, 4816, 5168, 4707, 4285, 5011, 4859, 4413, 5108, 4981, 4994],
		[453, 423, 455, 462, 462, 483, 486, 414, 481, 503, 462, 438, 498, 478, 500, 506, 470, 480, 425, 418, 501, 483, 451, 451, 461, 433, 498, 471, 476, 454, 473],
		[274, 274, 242, 256, 272, 241, 242, 272, 235, 277, 251, 278, 256, 241, 264, 278, 254, 272, 255, 279, 234, 267, 277, 271, 259, 237, 269, 267, 269, 262, 269],
		[189, 182, 188, 189, 168, 181, 172, 179, 187, 157, 165, 175, 189, 185, 185, 165, 182, 182, 182, 163, 186, 187, 176, 163, 168, 173, 179, 180, 182, 159, 175],
		[438, 453, 445, 455, 474, 419, 483, 466, 456, 442, 460, 467, 486, 475, 470, 476, 460, 463, 477, 460, 413, 431, 485, 423, 414, 464, 438, 414, 417, 460, 462],
		[35479, 33311, 32507, 36711, 36853, 35952, 32025, 35772, 35054, 36212, 38382, 38683, 32042, 36859, 33706, 34771, 37383, 36876, 34971, 36057, 36077, 38358, 33476, 36760, 32573, 36640, 35530, 37460, 37223, 34889, 34887]
	];
	var units = ["金門金沙", "台中生水池", "興達生水池", "嘉義民雄", "中部儲運", "東勢新伯公", "永安鹽灘地",
                  "路北", "中大", "大潭生水池", "核三生水池", "七美", "尖山", "卓蘭", "后里", "台中龍井"];
	
	// get taiwan time
	var d = new Date()
	var date = d.toLocaleString('en-US', {day: '2-digit',   timeZone: 'Asia/Taipei' });
	var hour = d.toLocaleString('en-US', {hour: '2-digit',   hour12: false, timeZone: 'Asia/Taipei' });
		
	// generate json string
	var jsonString = "{";
	for (i = 0; i < units.length; i++) {
		jsonString = jsonString + '"' + units[i] + '": [';
		var total = 0;
		for(j = 0; j < 31; j++) {
			var day_pw = 0;
			
			if(j+1 < date) { //past
				day_pw = pwarray[i][j];
			} else if(j+1 == date){ //current day
				if(hour < 5) {
					day_pw = 0;
				} else if (hour >= 5 && hour <= 18) {
					day_pw = Math.round((hour-5)/13*pwarray[i][j]);
				} else {
					day_pw = pwarray[i][j];
				}
			}
			
			total += day_pw;
			jsonString = jsonString + '"' + day_pw + '"';
			if(j < 30) {jsonString += ",";}
		}
		jsonString = jsonString + ', "' + total + '"]';
		
		if(i < units.length-1) {
			jsonString += ",";
		}
	}
	jsonString += "}";
		
	response.json(JSON.parse(jsonString));
});

app.listen(app.get('port'), function() {
  console.log('Node app is running on port', app.get('port'));
});
